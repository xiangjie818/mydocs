<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CubeFS安装部署</title>
    <link href="/mydocs/2024/08/09/cubefs-install/"/>
    <url>/mydocs/2024/08/09/cubefs-install/</url>
    
    <content type="html"><![CDATA[<p>CubeFS是新一代云原生存储产品，目前是云原生计算基金会（CNCF）托管的孵化阶段开源项目， 兼容S3、POSIX、HDFS等多种访问协议，支持多副本与纠删码两种存储引擎，为用户提供多租户、 多AZ部署以及跨区域复制等多种特性，广泛应用于大数据、AI、容器平台、数据库、中间件存算分离、数据共享以及数据保护等场景。</p><span id="more"></span><p>本文介绍如何使用Ansible部署CubeFS集群，目前仅支持副本模式的安装。</p><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><table><thead><tr><th>IP</th><th>CPU</th><th>内存</th><th>硬盘</th></tr></thead><tbody><tr><td>192.168.0.1</td><td>40</td><td>128G</td><td>8T * 8</td></tr><tr><td>192.168.0.2</td><td>40</td><td>128G</td><td>8T * 8</td></tr><tr><td>192.168.0.3</td><td>40</td><td>128G</td><td>8T * 8</td></tr></tbody></table><h2 id="部署过程"><a href="#部署过程" class="headerlink" title="部署过程"></a>部署过程</h2><p>下载ansible-cubefs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/xiangjie818/ansible-cubefs.git<br></code></pre></td></tr></table></figure><p>修改inventry文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[cubefs]<br>192.168.0.1 master=True meta=True data=True object=True<br>192.168.0.2 master=True meta=True data=True object=True<br>192.168.0.3 master=True meta=True data=True object=True<br><br>[consul]<br>192.168.0.1<br>192.168.0.2<br>192.168.0.3<br><br>[all:vars]<br>ansible_ssh_port=22<br></code></pre></td></tr></table></figure><p>修改group_vars&#x2F;all.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置CubeFS安装信息</span><br><span class="hljs-comment"># 这里填写CubeFS安装包名称和下载地址，根据实际情况进行调整</span><br><span class="hljs-attr">cubefs_package:</span> <span class="hljs-string">cubefs-3.3.1-linux-amd64.tar.gz</span><br><span class="hljs-attr">download_site:</span> <span class="hljs-string">http://s3.jishu.idc/spider-internal-read/cubefs/</span><br><span class="hljs-attr">cluster_name:</span> <span class="hljs-string">cubefs</span><br><span class="hljs-attr">cubefs_meta_memRatio:</span> <span class="hljs-number">75</span><br><span class="hljs-comment"># 配置Consul地址, 需要提前配置好consul集群，并配置域名, 安装文件和下载地址根据实际情况进行修改</span><br><span class="hljs-attr">consul_addr:</span> <span class="hljs-string">http://cfsconsul.paas.idc</span><br><span class="hljs-attr">consul_package:</span> <span class="hljs-string">consul_1.15.2_linux_amd64.tar.gz</span><br><span class="hljs-attr">consul_download_site:</span> <span class="hljs-string">http://s3.jishu.idc/spider-internal-read/consul</span><br><br><span class="hljs-attr">cubefs_master_host:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span><br><br><span class="hljs-comment"># 配置数据盘的挂载路径</span><br><span class="hljs-attr">mountmap:</span><br>  <span class="hljs-string">/dev/sdb:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data1</span><br>  <span class="hljs-string">/dev/sdc:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data2</span><br>  <span class="hljs-string">/dev/sdd:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data3</span><br>  <span class="hljs-string">/dev/sde:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data4</span><br>  <span class="hljs-string">/dev/sdf:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data5</span><br>  <span class="hljs-string">/dev/sdg:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data6</span><br>  <span class="hljs-string">/dev/sdh:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data7</span><br>  <span class="hljs-string">/dev/sdi:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">/cfs/data8</span><br></code></pre></td></tr></table></figure><p>开始安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ansible-playbook cubefs.yaml -i hosts<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>分布式存储</category>
      
      <category>CubeFS</category>
      
      <category>安装部署</category>
      
    </categories>
    
    
    <tags>
      
      <tag>storage</tag>
      
      <tag>cubefs</tag>
      
      <tag>heketi</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用Heketi管理GlusterFS集群</title>
    <link href="/mydocs/2024/08/09/heketi_manage_glusterfs/"/>
    <url>/mydocs/2024/08/09/heketi_manage_glusterfs/</url>
    
    <content type="html"><![CDATA[<p>Heketi是一个开源的分布式存储管理工具，它允许用户在多个节点上运行GlusterFS集群，并使用RESTful API管理存储资源。</p><span id="more"></span><h2 id="获取集群的topology信息"><a href="#获取集群的topology信息" class="headerlink" title="获取集群的topology信息"></a>获取集群的topology信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ heketi-cli topology info --json &gt; /tmp/topology<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>由于频繁的获取topology会对heketi产生一定的压力，所以这里把查询的信息写入到文件，之后的操作直接读取保存的文件，避免频繁的访问heketi</p>          </div><h2 id="根据brickID查询volume名称"><a href="#根据brickID查询volume名称" class="headerlink" title="根据brickID查询volume名称"></a>根据brickID查询volume名称</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /tmp/topology  | jq -r <span class="hljs-string">&#x27;.clusters[0].volumes[] | select(.bricks[].id == &quot;52decd5f6dd71c40ef967cf0f0f8f55d&quot;)&#x27;</span> | jq .name<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>分布式存储</category>
      
      <category>GlusterFS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>storage</tag>
      
      <tag>heketi</tag>
      
      <tag>linux</tag>
      
      <tag>glusterfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
